<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>FranksMa BLOG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="FranksMa BLOG">
<meta property="og:url" content="https://franksma.github.io/index.html">
<meta property="og:site_name" content="FranksMa BLOG">
<meta property="og:locale">
<meta property="article:author" content="TIANQI MA">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="FranksMa BLOG" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">FranksMa BLOG</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://franksma.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-算法学习笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2021-01-17T17:15:08.000Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/18/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">算法学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天开始学习算法和设计模式<br>主要学习资料是<br>视频 <a target="_blank" rel="noopener" href="https://www.youtube.com/channel/UC5xDNEcvb1vgw3lE21Ack2Q">Hua Hua</a><br>博客 <a target="_blank" rel="noopener" href="https://zxi.mytechroad.com/blog/">Huahua’s Tech Road</a></p>
<h1><span id="20200418">20200418</span><a href="#20200418" class="header-anchor">#</a></h1><p>学习了并查集，看了视频 <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=VJnUwsE4fWA"><br>花花酱 Disjoint-set/Union-find Forest - 刷题找工作 SP1</a> ，  <a target="_blank" rel="noopener" href="https://zxi.mytechroad.com/blog/data-structure/sp1-union-find-set/">博客文章</a><br>视频里面主要讲了 find 和 union 两个操作。<br>find 即找到节点的root。 对应路径压缩。 这里面有个点是，路径压缩是在find 的过程中进行的，如果不进行find，则不进行路径压缩。并且具体实现是通过递归实现。具体实现 我不太会用语言描述，主要是对递归的理解不深。<strong>递归算法需要加强下</strong></p>
<p>union 对应分枝合并，将 rank 少的合并到 rank 多的。</p>
<p>并查集 这个算法 在 <a target="_blank" rel="noopener" href="https://item.jd.com/11098789.html">算法(第4版) [Algorithms Fourth Edition]</a>  这本书里面是单独的一个章节 还需要详细学习下。。</p>
<p>参考链接<br><a target="_blank" rel="noopener" href="https://www.cs.princeton.edu/courses/archive/spring13/cos423/lectures/UnionFind.pdf">https://www.cs.princeton.edu/courses/archive/spring13/cos423/lectures/UnionFind.pdf</a></p>
<h1><span id="20200425">20200425</span><a href="#20200425" class="header-anchor">#</a></h1><p>根据数据输入规模估算时间复杂度，从而大概找到对应的算法。<br><img src="/media/15878003520657.jpg"></p>
<p>树状数组 (没搞懂，找别的资料看一下)</p>
<p><img src="/media/15878005034918.jpg"></p>
<p>线程与进程</p>
<p><img src="/media/15878051796647.jpg"></p>
<h1><span id="20200512">20200512</span><a href="#20200512" class="header-anchor">#</a></h1><h2><span id="zheng-ze-biao-da-shi-ru-men">正则表达式入门</span><a href="#zheng-ze-biao-da-shi-ru-men" class="header-anchor">#</a></h2><p><code>A.*A</code> 字符串中有两个A<br><code>LLL</code> 字符串中有连续三个L<br><code>A.*A｜LLL</code> 字符串中有两个A 或者连续的三个L<br>正则表达式的优势 是 <em>可读性高</em>。</p>
<h2><span id="dong-tai-gui-hua-ru-men">动态规划入门</span><a href="#dong-tai-gui-hua-ru-men" class="header-anchor">#</a></h2><p><img src="/media/15892969856518.jpg"><br>这个题目的思路是找到中间节点 如果前i的子串中间节点右边的串在字典中 ，那么前i的子串就是可分割的。<br>整个字符串是否可分割即 i 等于 字符串长度 时是否能找到中间节点右边的串在字典中。<br><img src="/media/15892976091142.jpg"></p>
<p>这里先是在 s 前加了一个空字符。<br>然后构造了长度为n+1,初始值为0的数组，标记 s 前 i 长度的字符串是否可以被分割。<br>f[0] = 1 的意思是 s 是空字符串。</p>
<p>两层循环。<br>外层循环是整个问题的规模。即s 的长度。<br>内层循环是子问题，j 从 0 到 i。如果j 右边到i 的字符串在字典中，即 s[0:i]是可以被分割的。就可以跳出内层循环了。<br>逐步扩大求解范围，通过解决子问题，从而得到整体问题的解。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://franksma.github.io/2021/01/18/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckk718x8d000cd64a2z4ncltq" data-title="算法学习笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Rust-学习笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/17/Rust-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2021-01-17T15:31:51.000Z" itemprop="datePublished">2021-01-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/17/Rust-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Rust 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <div class="toc">

<!-- toc -->

<ul>
<li><a href="#1-ji-chu-yu-fa-xue-xi">1 基础语法学习</a><ul>
<li><a href="#1-1-print">1.1 print</a></li>
<li><a href="#1-2-display">1.2 display</a></li>
<li><a href="#1-3-trait">1.3 trait</a></li>
</ul>
</li>
<li><a href="#2-rust-you-xiu-kai-yuan-xiang-mu">2 rust优秀开源项目</a><ul>
<li><a href="#2-1-xiang-mu-lie-biao">2.1 项目列表</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="1-ji-chu-yu-fa-xue-xi">1 基础语法学习</span><a href="#1-ji-chu-yu-fa-xue-xi" class="header-anchor">#</a></h1><h2><span id="1-1-print">1.1 print</span><a href="#1-1-print" class="header-anchor">#</a></h2><p><code>&#123;:?&#125;</code> 可进行有格式的打印，是 Debug 宏的实现<br><code>#[derive(Debug)]</code> 如要打印结构体数据 需要添加这个’宏定义’ </p>
<h2><span id="1-2-display">1.2 display</span><a href="#1-2-display" class="header-anchor">#</a></h2><p>如果系统的 <code>print</code> 无法满足需求, 可自己实现 <code>display</code> 进行格式化打印。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt; <span class="comment">// Import the `fmt` module.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define a structure named `List` containing a `Vec`.</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">List</span></span>(<span class="built_in">Vec</span>&lt;<span class="built_in">i32</span>&gt;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> fmt::Display <span class="keyword">for</span> List &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">fmt</span></span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter) -&gt; fmt::<span class="built_in">Result</span> &#123;</span><br><span class="line">        <span class="comment">// Extract the value using tuple indexing,</span></span><br><span class="line">        <span class="comment">// and create a reference to `vec`.</span></span><br><span class="line">        <span class="keyword">let</span> vec = &amp;<span class="keyword">self</span>.<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">write!</span>(f, <span class="string">&quot;[&quot;</span>)?;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Iterate over `v` in `vec` while enumerating the iteration</span></span><br><span class="line">        <span class="comment">// count in `count`.</span></span><br><span class="line">        <span class="keyword">for</span> (count, v) <span class="keyword">in</span> vec.iter().enumerate() &#123;</span><br><span class="line">            <span class="comment">// For every element except the first, add a comma.</span></span><br><span class="line">            <span class="comment">// Use the ? operator to return on errors.</span></span><br><span class="line">            <span class="keyword">if</span> count != <span class="number">0</span> &#123; <span class="built_in">write!</span>(f, <span class="string">&quot;, &quot;</span>)?; &#125;</span><br><span class="line">            <span class="built_in">write!</span>(f, <span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, count, v)?;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Close the opened bracket and return a fmt::Result value.</span></span><br><span class="line">        <span class="built_in">write!</span>(f, <span class="string">&quot;]&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> v = List(<span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="1-3-trait">1.3 trait</span><a href="#1-3-trait" class="header-anchor">#</a></h2><p>trait 实际就是接口的意思。trait 告诉 Rust 编译器某个特定类型拥有可能与其他类型共享的功能。可以通过 trait 以一种抽象的方式定义共享的行为。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明一个 summary 的 trait, 并且有默认的实现</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Summary</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="built_in">String</span>::from(<span class="string">&quot;(read more...)&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">NewsArticle</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> headline: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> location: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> author: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对 NewsArticle 的 Summary 实现</span></span><br><span class="line"><span class="keyword">impl</span> Summary <span class="keyword">for</span> NewsArticle &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;, by &#123;&#125; (&#123;&#125;)&quot;</span>, <span class="keyword">self</span>.headline, <span class="keyword">self</span>.author, <span class="keyword">self</span>.location)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Tweet</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> username: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> reply: <span class="built_in">bool</span>,</span><br><span class="line">    <span class="keyword">pub</span> retweet: <span class="built_in">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对 Tweet 的 Summary 实现</span></span><br><span class="line"><span class="keyword">impl</span> Summary <span class="keyword">for</span> Tweet &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">NewComment</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> author: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不实现自己的 Summary，使用默认实现</span></span><br><span class="line"><span class="keyword">impl</span> Summary <span class="keyword">for</span> NewComment &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 trait 作为参数，参数对象必须有 trait 的实现</span></span><br><span class="line"><span class="comment">// 可以传递任何 NewsArticle 或 Tweet 的实例来调用 notify。</span></span><br><span class="line"><span class="comment">// 任何用其它如 String 或 i32 的类型调用该函数的代码都不能编译，因为它们没有实现 Summary。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>(item: <span class="keyword">impl</span> Summary) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news &#123;&#125;&quot;</span>,item.summarize());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> tweet = Tweet &#123;</span><br><span class="line">        username: <span class="built_in">String</span>::from(<span class="string">&quot;horse_ebooks&quot;</span>),</span><br><span class="line">        content: <span class="built_in">String</span>::from(<span class="string">&quot;of course, as you probably already know, people&quot;</span>),</span><br><span class="line">        reply: <span class="literal">false</span>,</span><br><span class="line">        retweet: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> article = NewsArticle &#123;</span><br><span class="line">        headline: <span class="built_in">String</span>::from(<span class="string">&quot;hello world&quot;</span>),</span><br><span class="line">        location: <span class="built_in">String</span>::from(<span class="string">&quot;beijing&quot;</span>),</span><br><span class="line">        author: <span class="built_in">String</span>::from(<span class="string">&quot;matianqi&quot;</span>),</span><br><span class="line">        content: <span class="built_in">String</span>::from(<span class="string">&quot;read the book&quot;</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;1 new tweet: &#123;&#125;&quot;</span>, tweet.summarize());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;1 new article: &#123;&#125;&quot;</span>,article.summarize());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写法1</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>(item: <span class="keyword">impl</span> Summary) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.summarize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写法2</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>&lt;T: Summary&gt;(item: T) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.summarize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的 <code>写法1</code> 和 <code>写法2</code> 具有同样的效果，<code>写法1</code> 叫 <code>impl trait</code> , <code>写法2</code> 叫 <code>trait bound</code> 。</p>
<p>通过 <code>+</code> 指定多个 <code>trait bound</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>(item: <span class="keyword">impl</span> Summary + Display) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>&lt;T: Summary + Display&gt;(item: T) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>当有多个泛型参数，使用<code>where</code> 从句指定 <code>trait bound</code>的语法。<br>这里实际上是 在where 中 描述了 函数泛型参数 具有哪些trait 。表现更规整。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">some_function</span></span>&lt;T: Display + <span class="built_in">Clone</span>, U: <span class="built_in">Clone</span> + <span class="built_in">Debug</span>&gt;(t: T, u: U) -&gt; <span class="built_in">i32</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">some_function</span></span>&lt;T, U&gt;(t: T, u: U) -&gt; <span class="built_in">i32</span></span><br><span class="line">    <span class="keyword">where</span> T: Display + <span class="built_in">Clone</span>,</span><br><span class="line">          U: <span class="built_in">Clone</span> + <span class="built_in">Debug</span></span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>返回值使用 <code>trait</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">returns_summarizable</span></span>() -&gt; <span class="keyword">impl</span> Summary &#123;</span><br><span class="line">    Tweet &#123;</span><br><span class="line">        username: <span class="built_in">String</span>::from(<span class="string">&quot;horse_ebooks&quot;</span>),</span><br><span class="line">        content: <span class="built_in">String</span>::from(<span class="string">&quot;of course, as you probably already know, people&quot;</span>),</span><br><span class="line">        reply: <span class="literal">false</span>,</span><br><span class="line">        retweet: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用 trait 求最大值</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里还有另外一种写法是，返回值为 `slice` 中 `T` 的 引用</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">largest</span></span>&lt;T: <span class="built_in">PartialOrd</span> + <span class="built_in">Copy</span>&gt;(list: &amp;[T]) -&gt; T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> largest = list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list.iter() &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> number_list = <span class="built_in">vec!</span>[<span class="number">34</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">65</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = largest(&amp;number_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> char_list = <span class="built_in">vec!</span>[<span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;q&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = largest(&amp;char_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest char is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1><span id="2-rust-you-xiu-kai-yuan-xiang-mu">2 rust优秀开源项目</span><a href="#2-rust-you-xiu-kai-yuan-xiang-mu" class="header-anchor">#</a></h1><h2><span id="2-1-xiang-mu-lie-biao">2.1 项目列表</span><a href="#2-1-xiang-mu-lie-biao" class="header-anchor">#</a></h2><p><a target="_blank" rel="noopener" href="https://github.com/tikv/tikv">TiKV</a><br>PingCAP公司开源的TiDB的存储引擎。（我也不知道是啥～～～）</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mesalock-linux/mesalink">mesalink</a><br>百度安全部，为解决OpenSSL心脏滴血等漏洞，用rust写的SSL实现。（目前好像没人维护了，Maintainer 去了google）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://franksma.github.io/2021/01/17/Rust-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckk718x850004d64a77uf2bp4" data-title="Rust 学习笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-毕业答辩完成" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/03/09/%E6%AF%95%E4%B8%9A%E7%AD%94%E8%BE%A9%E5%AE%8C%E6%88%90/" class="article-date">
  <time class="dt-published" datetime="2018-03-09T14:48:26.000Z" itemprop="datePublished">2018-03-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/03/09/%E6%AF%95%E4%B8%9A%E7%AD%94%E8%BE%A9%E5%AE%8C%E6%88%90/">毕业答辩完成</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天毕业答辩通过，也算是给研究生时期画了一个句号。</p>
<p>不自信的讲，我是一个来自二本学校的学生，高考考过两次才考上二本，研究生又考了两次。也算是补回了小学时提前上学的时间。研究生期间，我一直在追赶我的同学，努力去补本科时期留下的坑。并且拓宽自己的认知。</p>
<p>值得说的是，在红帽实习期间，见识了计算机行业最顶尖的程序员，那群写开源软件的大拿，我和他们的差距还很远。首先是语言，英语是科技行业的通用语言，有良好的英语基础，才能听懂别人在说一个什么样的事情。但是听懂还不够，得领会别人的思想，才能有效的交流。我在研究生期间学习英语的最多时间是看英语论文和查英语资料。这个公司提倡分享和表达，果然是开源世界的第一商业公司。不过北京这边的职位均是测试岗位，时间长了会有点枯燥。有remote的工作，均是开源项目的贡献者。以后有机会可以去试一试。见识一下这个世界的顶级开发者。</p>
<p>再就是毕业论文的书写。那段时间真的是焦头烂额。论文的方方面面太多了。要兼顾论文的书写和系统的设计与实现。不过好歹最后完成并通过了答辩。</p>
<p>就我自己来说，做一件事情首先得看好的一面，要开始做起来，里面的坑和难处得经历一遍才能让自己涨经验和知识。所以重要的是坚持。不要有顾虑，没什么大不了的。</p>
<p>最后要保持身体健康，不要暴饮暴食和醉酒熬夜。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://franksma.github.io/2018/03/09/%E6%AF%95%E4%B8%9A%E7%AD%94%E8%BE%A9%E5%AE%8C%E6%88%90/" data-id="ckk718x8e000dd64aeaq9fcxv" data-title="毕业答辩完成" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%95%E4%B8%9A/" rel="tag">毕业</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-套接字中SO-REUSEPORT和SO-REUSEADDR" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/09/27/%E5%A5%97%E6%8E%A5%E5%AD%97%E4%B8%ADSO-REUSEPORT%E5%92%8CSO-REUSEADDR/" class="article-date">
  <time class="dt-published" datetime="2017-09-26T16:22:50.000Z" itemprop="datePublished">2017-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/27/%E5%A5%97%E6%8E%A5%E5%AD%97%E4%B8%ADSO-REUSEPORT%E5%92%8CSO-REUSEADDR/">套接字中SO_REUSEPORT和SO_REUSEADDR</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1><span id="q">Q</span><a href="#q" class="header-anchor">#</a></h1><p>可否多个进程监听同一个端口</p>
<h1><span id="a">A</span><a href="#a" class="header-anchor">#</a></h1><p>可通过两种方式在同一个端口上监听</p>
<ul>
<li>设置 <strong>SO_REUSEPORT</strong></li>
<li>设置 <strong>SO_REUSEADDR</strong></li>
</ul>
<h2><span id="so-reuseport">SO_REUSEPORT</span><a href="#so-reuseport" class="header-anchor">#</a></h2><p>测试代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">SO_REUSEPORT = <span class="number">15</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEPORT, <span class="number">1</span>)</span><br><span class="line">s.bind((<span class="string">&#x27;&#x27;</span>, <span class="number">10000</span>))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    conn, addr = s.accept()</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Connected to %d \t addr: %s &quot;</span> % (os.getpid(),addr)</span><br><span class="line">    <span class="comment">#data = conn.recv(1024)</span></span><br><span class="line">    conn.send(<span class="string">&#x27;Connected to &#123;&#125; \n&#x27;</span>.<span class="built_in">format</span>(os.getpid()))</span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>
<p>这个参数在 MacOS 和 Linux 上被设置后，<strong>效果是不一样</strong>的。</p>
<h3><span id="zai-macos-shang-de-xiao-guo">在 MacOS 上的效果</span><a href="#zai-macos-shang-de-xiao-guo" class="header-anchor">#</a></h3><ul>
<li>能无冲突的开启两个不同的进程</li>
</ul>
<p><img src="/media/15064446169076.jpg"><br>其中<strong>PID 23601</strong> 是第一个开启，<strong>PID 23696</strong> 是第二个开启的。</p>
<ul>
<li>使用nc去连接该端口</li>
</ul>
<p><img src="/media/15064447308245.jpg"><br>可以看到 只有 <strong>PID 23601</strong> 的socket 被连接<br>只有在kill 掉 <strong>PID 23601</strong> 后 <strong>PID 23696</strong> 才会被连接</p>
<ul>
<li>并且可以在不同用户下运行该程序</li>
</ul>
<p><img src="/media/15064452264993.jpg"><br>接入顺序还是和前面的相同，先开启的进程会去接受请求，后开启的进程只有在先开启的进程结束后才能接受请求。</p>
<h3><span id="zai-linux-shang-de-xiao-guo">在Linux上的效果</span><a href="#zai-linux-shang-de-xiao-guo" class="header-anchor">#</a></h3><ul>
<li><p>与MacOS不同之处在于，Linux 会<strong>随机</strong>（可能是某种算法）选择进程去接受请求。<br><img src="/media/15064456629605.jpg"><br><img src="/media/15064456973224.jpg"><br>这样的好处是，上层程序可以将负载均衡完全交给系统层去完成。</p>
</li>
<li><p>在用不同账户去尝试运行这个程序时会报错<br><img src="/media/15064460759272.jpg"></p>
</li>
</ul>
<p>这符合参考文档中的说明，linux 可以让多进程重用端口，但是这些进程必须是同一个账户。显然 Mac OS 的相关机制不同。</p>
<h3><span id="ling-wai">另外</span><a href="#ling-wai" class="header-anchor">#</a></h3><p>参考文档中说 <strong>SO_REUSEPORT</strong>  是在<strong>Linux 3.9</strong> 之后加入的。<br>我的实验环境的内核版本为<strong>2.6</strong><br><img src="/media/15064464767608.jpg"></p>
<p>学校网关用的是 NAT 而不是 NAPT 只对 IP 地址进行了转换，<strong>端口号不变</strong>。</p>
<h1><span id="reference">reference</span><a href="#reference" class="header-anchor">#</a></h1><blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/Yaokai_AssultMaster/article/details/68951150">http://blog.csdn.net/Yaokai_AssultMaster/article/details/68951150</a></p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/14388706/socket-options-so-reuseaddr-and-so-reuseport-how-do-they-differ-do-they-mean-t">https://stackoverflow.com/questions/14388706/socket-options-so-reuseaddr-and-so-reuseport-how-do-they-differ-do-they-mean-t</a></p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://bg2bkk.github.io/post/SO_REUSEADDR%E5%92%8CSO_REUSEPORT/">https://bg2bkk.github.io/post/SO_REUSEADDR%E5%92%8CSO_REUSEPORT/</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://franksma.github.io/2017/09/27/%E5%A5%97%E6%8E%A5%E5%AD%97%E4%B8%ADSO-REUSEPORT%E5%92%8CSO-REUSEADDR/" data-id="ckk718x8c0009d64a8b67d0y5" data-title="套接字中SO_REUSEPORT和SO_REUSEADDR" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/socket/" rel="tag">socket</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Understanding-the-Linux-kernel-笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/09/26/Understanding-the-Linux-kernel-%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2017-09-25T16:27:49.000Z" itemprop="datePublished">2017-09-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/26/Understanding-the-Linux-kernel-%E7%AC%94%E8%AE%B0/">Understanding the Linux kernel 笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <div class="toc">

<!-- toc -->

<ul>
<li><a href="#yong-hu-tai-nei-he-tai">用户态&amp;内核态</a><ul>
<li><a href="#jie-xi">解析</a></li>
<li><a href="#references">References</a></li>
</ul>
</li>
<li><a href="#jin-cheng-xian-cheng">进程&amp;线程</a><ul>
<li><a href="#jin-cheng-yu-xian-cheng-de-zhu-yao-qu-bie">进程与线程的主要区别</a></li>
<li><a href="#can-kao-lian-jie">参考链接</a></li>
</ul>
</li>
<li><a href="#di-san-zhang-jin-cheng">第三章 进程</a><ul>
<li><a href="#jin-cheng-miao-shu-fu">进程描述符</a></li>
<li><a href="#jin-cheng-zhuang-tai">进程状态</a></li>
<li><a href="#yi-wen">疑问</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="yong-hu-tai-amp-nei-he-tai">用户态&amp;内核态</span><a href="#yong-hu-tai-amp-nei-he-tai" class="header-anchor">#</a></h1><h2><span id="jie-xi">解析</span><a href="#jie-xi" class="header-anchor">#</a></h2><p>经常会提到 <code>用户态</code>, <code>内核态</code>, <code>用户空间</code>, <code>内核空间</code> 这几个概念，但是对其理解并不深刻，只有一个感性的认识，知其然，不知其所以然。</p>
<p>下面这个程序是进行归并排序，数据量为<strong>5000000</strong> </p>
<p>当前排序操作不涉及外部存储，不存在系统调用，通过<code>top</code> 命令可以看到,cpu 99.7 us。</p>
<p>其中，第一项<code>99.7 us</code>（user 的缩写）就是 CPU 消耗在 User space 的时间百分比。第二项<code>0.3 sy</code>（system 的缩写）是消耗在 Kernel space 的时间百分比。</p>
<ul>
<li>ni：niceness 的缩写，CPU 消耗在 nice 进程（低优先级）的时间百分比</li>
<li>id：idle 的缩写，CPU 消耗在闲置进程的时间百分比，这个值越低，表示 CPU 越忙</li>
<li>wa：wait 的缩写，CPU 等待外部 I/O 的时间百分比，这段时间 CPU 不能干其他事，但是也没有执行运算，这个值太高就说明外部设备有问题</li>
<li>hi：hardware interrupt 的缩写，CPU 响应硬件中断请求的时间百分比</li>
<li>si：software interrupt 的缩写，CPU 响应软件中断请求的时间百分比</li>
<li>st：stole time 的缩写，该项指标只对虚拟机有效，表示分配给当前虚拟机的 CPU 时间之中，被同一台物理机上的其他虚拟机偷走的时间百分比</li>
</ul>
<p><img src="/media/15037985050367.jpg"></p>
<p><img src="/media/15037985410929.jpg"></p>
<p><img src="/media/15037982776435.jpg"></p>
<p><img src="/media/15038044263713.jpg"></p>
<p>以下命令生成10G文件，可以看到 <code>wa</code> 的值为97.9<br><code>dd if=/dev/zero of=/root/randomfile bs=1M count=10240</code></p>
<p><img src="/media/15038044465989.jpg"></p>
<p>下面的程序，既有计算的操作也有写文件的操作，在用户空间和内核空间进行切换操作。在程序优化上可将这类操作进行分块进行，防止程序进行大量的上下文切换，可以提高性能。<br><em>具体优化方法，我还不知道～</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for i in range(1000000):</span><br><span class="line">    i+1  #用户空间</span><br><span class="line">    fd &#x3D; open(&quot;test.file&quot;,&quot;a+&quot;)</span><br><span class="line">    fd.write(str(i)) #内核空间</span><br><span class="line">    fd.write(&quot;\n&quot;)  #内核空间</span><br><span class="line">    fd.close()</span><br><span class="line">    i*i #用户空间</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># time python test.py</span><br><span class="line">python test.py  2.24s user 4.74s system 98% cpu 7.067 total</span><br></pre></td></tr></table></figure>
<p><img src="/media/15038053494027.jpg"></p>
<h2><span id="references">References</span><a href="#references" class="header-anchor">#</a></h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/12/user_space_vs_kernel_space.html">http://www.ruanyifeng.com/blog/2016/12/user_space_vs_kernel_space.html</a></p>
</blockquote>
<h1><span id="jin-cheng-amp-xian-cheng">进程&amp;线程</span><a href="#jin-cheng-amp-xian-cheng" class="header-anchor">#</a></h1><h2><span id="jin-cheng-yu-xian-cheng-de-zhu-yao-qu-bie">进程与线程的主要区别</span><a href="#jin-cheng-yu-xian-cheng-de-zhu-yao-qu-bie" class="header-anchor">#</a></h2><ol>
<li>线程共享创建它的进程的地址空间，而进程有独立的地址空间</li>
<li>线程对所在进程中的数据段可以直接访问，子进程具有父进程的数据段副本</li>
<li>线程能与其它同一进程内的线程进行通信，进程间使用进程间通信手段进行通信<ul>
<li>进程间通信：<ul>
<li>管道和FIFO</li>
<li>信号量</li>
<li>消息 </li>
<li>共享内存区   最高效的进程通信方式，zero copy？</li>
<li>套接字   socket </li>
</ul>
</li>
</ul>
</li>
<li>线程几乎没有开销，进程有相当大的开销</li>
<li>新线程很容易创建，新进程需要父进程进行复制操作</li>
<li>线程可以对同一进程下的其他线程进行控制，进程只能控制其子进程</li>
<li>对主线线程的更改（撤销，优先级更改）可能会影响进程中的其他线程，对父进程进行修改不会影响子进程。</li>
</ol>
<h2><span id="can-kao-lian-jie">参考链接</span><a href="#can-kao-lian-jie" class="header-anchor">#</a></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/200469/what-is-the-difference-between-a-process-and-a-thread">https://stackoverflow.com/questions/200469/what-is-the-difference-between-a-process-and-a-thread</a></p>
</blockquote>
<h1><span id="di-san-zhang-jin-cheng">第三章 进程</span><a href="#di-san-zhang-jin-cheng" class="header-anchor">#</a></h1><h2><span id="jin-cheng-miao-shu-fu">进程描述符</span><a href="#jin-cheng-miao-shu-fu" class="header-anchor">#</a></h2><p>进程描述符是<strong>task_struct</strong>类型结构体。该结构体的定义的文件位置是<br><code>/Users/matianqi/Project/Linux_Kernel/linux-2.6.11/include/linux/sched.h</code><br>具体定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> &#123;</span></span><br><span class="line">	<span class="keyword">volatile</span> <span class="keyword">long</span> state;	<span class="comment">/* -1 unrunnable, 0 runnable, &gt;0 stopped */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">thread_info</span> *<span class="title">thread_info</span>;</span> <span class="comment">/* 进程的基本信息 */</span></span><br><span class="line">	<span class="keyword">atomic_t</span> usage;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;	<span class="comment">/* per process flags, defined below */</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> ptrace;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> lock_depth;		<span class="comment">/* Lock depth */</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> prio, static_prio;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">run_list</span>;</span></span><br><span class="line">	<span class="keyword">prio_array_t</span> *<span class="built_in">array</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> sleep_avg;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> timestamp, last_ran;</span><br><span class="line">	<span class="keyword">int</span> activated;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> policy;</span><br><span class="line">	<span class="keyword">cpumask_t</span> cpus_allowed;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> time_slice, first_time_slice;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHEDSTATS</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_info</span> <span class="title">sched_info</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">tasks</span>;</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * ptrace_list/ptrace_children forms the list of my children</span></span><br><span class="line"><span class="comment">	 * that were stolen by a ptracer.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">ptrace_children</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">ptrace_list</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mm_struct</span> *<span class="title">mm</span>, *<span class="title">active_mm</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* task state */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">linux_binfmt</span> *<span class="title">binfmt</span>;</span></span><br><span class="line">	<span class="keyword">long</span> exit_state;</span><br><span class="line">	<span class="keyword">int</span> exit_code, exit_signal;</span><br><span class="line">	<span class="keyword">int</span> pdeath_signal;  <span class="comment">/*  The signal sent when the parent dies  */</span></span><br><span class="line">	<span class="comment">/* ??? */</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> personality;</span><br><span class="line">	<span class="keyword">unsigned</span> did_exec:<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">pid_t</span> pid;</span><br><span class="line">	<span class="keyword">pid_t</span> tgid;</span><br><span class="line">	<span class="comment">/* </span></span><br><span class="line"><span class="comment">	 * pointers to (original) parent process, youngest child, younger sibling,</span></span><br><span class="line"><span class="comment">	 * older sibling, respectively.  (p-&gt;father can be replaced with </span></span><br><span class="line"><span class="comment">	 * p-&gt;parent-&gt;pid)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">real_parent</span>;</span> <span class="comment">/* real parent process (when being debugged) */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">parent</span>;</span>	<span class="comment">/* parent process */</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * children/sibling forms the list of my children plus the</span></span><br><span class="line"><span class="comment">	 * tasks I&#x27;m ptracing.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">children</span>;</span>	<span class="comment">/* list of my children */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">sibling</span>;</span>	<span class="comment">/* linkage in my parent&#x27;s children list */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">group_leader</span>;</span>	<span class="comment">/* threadgroup leader */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* PID/PID hash table linkage. */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pid</span> <span class="title">pids</span>[<span class="title">PIDTYPE_MAX</span>];</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">completion</span> *<span class="title">vfork_done</span>;</span>		<span class="comment">/* for vfork() */</span></span><br><span class="line">	<span class="keyword">int</span> __user *set_child_tid;		<span class="comment">/* CLONE_CHILD_SETTID */</span></span><br><span class="line">	<span class="keyword">int</span> __user *clear_child_tid;		<span class="comment">/* CLONE_CHILD_CLEARTID */</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> rt_priority;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> it_real_value, it_real_incr;</span><br><span class="line">	<span class="keyword">cputime_t</span> it_virt_value, it_virt_incr;</span><br><span class="line">	<span class="keyword">cputime_t</span> it_prof_value, it_prof_incr;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">timer_list</span> <span class="title">real_timer</span>;</span></span><br><span class="line">	<span class="keyword">cputime_t</span> utime, stime;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> nvcsw, nivcsw; <span class="comment">/* context switch counts */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">timespec</span> <span class="title">start_time</span>;</span></span><br><span class="line"><span class="comment">/* mm fault and swap info: this can arguably be seen as either mm-specific or thread-specific */</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> min_flt, maj_flt;</span><br><span class="line"><span class="comment">/* process credentials */</span></span><br><span class="line">	<span class="keyword">uid_t</span> uid,euid,suid,fsuid;</span><br><span class="line">	<span class="keyword">gid_t</span> gid,egid,sgid,fsgid;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">group_info</span> *<span class="title">group_info</span>;</span></span><br><span class="line">	<span class="keyword">kernel_cap_t</span>   cap_effective, cap_inheritable, cap_permitted;</span><br><span class="line">	<span class="keyword">unsigned</span> keep_capabilities:<span class="number">1</span>;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">user_struct</span> *<span class="title">user</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_KEYS</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">key</span> *<span class="title">session_keyring</span>;</span>	<span class="comment">/* keyring inherited over fork */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">key</span> *<span class="title">process_keyring</span>;</span>	<span class="comment">/* keyring private to this process (CLONE_THREAD) */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">key</span> *<span class="title">thread_keyring</span>;</span>	<span class="comment">/* keyring private to this thread */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">int</span> oomkilladj; <span class="comment">/* OOM kill score adjustment (bit shift). */</span></span><br><span class="line">	<span class="keyword">char</span> comm[TASK_COMM_LEN];</span><br><span class="line"><span class="comment">/* file system info */</span></span><br><span class="line">	<span class="keyword">int</span> link_count, total_link_count;</span><br><span class="line"><span class="comment">/* ipc stuff */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sysv_sem</span> <span class="title">sysvsem</span>;</span></span><br><span class="line"><span class="comment">/* CPU-specific state of this task */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">thread_struct</span> <span class="title">thread</span>;</span></span><br><span class="line"><span class="comment">/* filesystem information */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">fs_struct</span> *<span class="title">fs</span>;</span></span><br><span class="line"><span class="comment">/* open file information */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">files_struct</span> *<span class="title">files</span>;</span></span><br><span class="line"><span class="comment">/* namespace */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">namespace</span> *<span class="title">namespace</span>;</span></span><br><span class="line"><span class="comment">/* signal handlers */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">signal_struct</span> *<span class="title">signal</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sighand_struct</span> *<span class="title">sighand</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">sigset_t</span> blocked, real_blocked;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sigpending</span> <span class="title">pending</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> sas_ss_sp;</span><br><span class="line">	<span class="keyword">size_t</span> sas_ss_size;</span><br><span class="line">	<span class="keyword">int</span> (*notifier)(<span class="keyword">void</span> *priv);</span><br><span class="line">	<span class="keyword">void</span> *notifier_data;</span><br><span class="line">	<span class="keyword">sigset_t</span> *notifier_mask;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">void</span> *security;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">audit_context</span> *<span class="title">audit_context</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Thread group tracking */</span></span><br><span class="line">   	u32 parent_exec_id;</span><br><span class="line">   	u32 self_exec_id;</span><br><span class="line"><span class="comment">/* Protection of (de-)allocation: mm, files, fs, tty, keyrings */</span></span><br><span class="line">	<span class="keyword">spinlock_t</span> alloc_lock;</span><br><span class="line"><span class="comment">/* Protection of proc_dentry: nesting proc_lock, dcache_lock, write_lock_irq(&amp;tasklist_lock); */</span></span><br><span class="line">	<span class="keyword">spinlock_t</span> proc_lock;</span><br><span class="line"><span class="comment">/* context-switch lock */</span></span><br><span class="line">	<span class="keyword">spinlock_t</span> switch_lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* journalling filesystem info */</span></span><br><span class="line">	<span class="keyword">void</span> *journal_info;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* VM state */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">reclaim_state</span> *<span class="title">reclaim_state</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dentry</span> *<span class="title">proc_dentry</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">backing_dev_info</span> *<span class="title">backing_dev_info</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">io_context</span> *<span class="title">io_context</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> ptrace_message;</span><br><span class="line">	<span class="keyword">siginfo_t</span> *last_siginfo; <span class="comment">/* For ptrace use.  */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * current io wait handle: wait queue entry to use for io waits</span></span><br><span class="line"><span class="comment"> * If this thread is processing aio, this points at the waitqueue</span></span><br><span class="line"><span class="comment"> * inside the currently handled kiocb. It may be NULL (i.e. default</span></span><br><span class="line"><span class="comment"> * to a stack based synchronous wait) if its doing sync IO.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">	<span class="keyword">wait_queue_t</span> *io_wait;</span><br><span class="line"><span class="comment">/* i/o counters(bytes read/written, #syscalls */</span></span><br><span class="line">	u64 rchar, wchar, syscr, syscw;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_BSD_PROCESS_ACCT)</span></span><br><span class="line">	u64 acct_rss_mem1;	<span class="comment">/* accumulated rss usage */</span></span><br><span class="line">	u64 acct_vm_mem1;	<span class="comment">/* accumulated virtual memory usage */</span></span><br><span class="line">	<span class="keyword">clock_t</span> acct_stimexpd;	<span class="comment">/* clock_t-converted stime since last update */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NUMA</span></span><br><span class="line">  	<span class="class"><span class="keyword">struct</span> <span class="title">mempolicy</span> *<span class="title">mempolicy</span>;</span></span><br><span class="line">	<span class="keyword">short</span> il_next;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>可以看到<strong>task_struct</strong>的定义有161行。</p>
<h2><span id="jin-cheng-zhuang-tai">进程状态</span><a href="#jin-cheng-zhuang-tai" class="header-anchor">#</a></h2><p>在该文件中有进程状态的宏定义</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TASK_RUNNING		0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TASK_INTERRUPTIBLE	1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TASK_UNINTERRUPTIBLE	2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TASK_STOPPED		4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TASK_TRACED		8</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXIT_ZOMBIE		16</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXIT_DEAD		32</span></span><br></pre></td></tr></table></figure>
<p>可以将以上的宏赋值给进程描述符的<strong>state</strong>字段，从而标示进程状态。</p>
<p><code>p-&gt;state = TASK_RUNNING</code></p>
<h2><span id="yi-wen">疑问</span><a href="#yi-wen" class="header-anchor">#</a></h2><ol>
<li><code>volatile long state;    /* -1 unrunnable, 0 runnable, &gt;0 stopped */</code> 中表示  <strong>state</strong> 的值大于0 时为stopped状态。这个stopped和 TASK_STOPPED有什么区别？</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://franksma.github.io/2017/09/26/Understanding-the-Linux-kernel-%E7%AC%94%E8%AE%B0/" data-id="ckk718x8b0007d64a2drz0ig2" data-title="Understanding the Linux kernel 笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-linux-kernel-development-阅读笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/09/17/linux-kernel-development-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2017-09-17T15:09:27.000Z" itemprop="datePublished">2017-09-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/17/linux-kernel-development-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">linux kernel development 阅读笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1><span id="di-san-zhang-jin-cheng-guan-li">第三章 进程管理</span><a href="#di-san-zhang-jin-cheng-guan-li" class="header-anchor">#</a></h1><h2><span id="shi-me-shi-jin-cheng">什么是进程</span><a href="#shi-me-shi-jin-cheng" class="header-anchor">#</a></h2><blockquote>
<p>Linux has a unique implementation of threads: It does not differentiate between threads and processes. To Linux, a thread is just a special kind of process.</p>
</blockquote>
<p>对 linux 来说 ，thread 和 process 并没有区别。<br>thread 只是特殊的 process</p>
<blockquote>
<p>On modern operating systems, processes provide two virtualizations: a virtualized processor and virtual memory. The virtual processor gives the process the illusion that it alone monopolizes the system, despite possibly sharing the processor among hundreds of other processes.</p>
</blockquote>
<blockquote>
<p>Chapter 4, “Process Scheduling,” discusses this virtualization.</p>
</blockquote>
<blockquote>
<p>Virtual memory lets the process allocate and manage memory as if it alone owned all the memory in the system. </p>
</blockquote>
<blockquote>
<p>Virtual memory is covered in Chapter 12, “Memory Management.” </p>
</blockquote>
<p>对 process 来说， process 好像独占cpu 和 memory。</p>
<h2><span id="jin-cheng-miao-shu-fu">进程描述符</span><a href="#jin-cheng-miao-shu-fu" class="header-anchor">#</a></h2><h3><span id="shi-me-shi-jin-cheng-miao-shu-fu">什么是进程描述符</span><a href="#shi-me-shi-jin-cheng-miao-shu-fu" class="header-anchor">#</a></h3><blockquote>
<p>The task_struct is a relatively large data structure, at around 1.7 kilobytes on a 32-bit machine. This size, however, is quite small considering that the structure contains all the information that the kernel has and needs about a process. The process descriptor contains the data that describes the executing program—open files, the process’s address space, pending signals, the process’s state, and much more.</p>
</blockquote>
<p><img src="/media/15056646399749.jpg"></p>
<h3><span id="jin-cheng-miao-shu-fu-fang-zai-na-li">进程描述符放在那里</span><a href="#jin-cheng-miao-shu-fu-fang-zai-na-li" class="header-anchor">#</a></h3><blockquote>
<p>The kernel stores the list of processes in a circular doubly linked list called the task list.</p>
</blockquote>
<p>在kernel中 进程描述符存储在环形双向链表（task list）中。</p>
<p>进程描述符 process descriptor ，定义在 <code>&lt;linux/sched.h&gt;</code><br>在 <strong>Understanding the Linux kernel 笔记(三) 第三章 进程</strong> 有贴出pd全部的定义<br>进程描述符在kernel的栈空间中所在的位置<br><img src="/media/15056625632416.jpg"></p>
<blockquote>
<p>The system identifies processes by a unique process identification value or PID.</p>
</blockquote>
<p>PID 有个默认的最大值 32768  </p>
<blockquote>
<p>this is controlled in <code>&lt;linux/threads.h&gt;</code></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This controls the default maximum pid allocated to a process</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PID_MAX_DEFAULT 0x8000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * A maximum of 4 million PIDs should be enough for a while:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PID_MAX_LIMIT (sizeof(long) &gt; 4 ? 4*1024*1024 : PID_MAX_DEFAULT)</span></span><br></pre></td></tr></table></figure>
<p>the administrator may increase the maximum value via <code>/proc/sys/kernel/pid_max</code></p>
<p>PID 最大值可通过改变 <code>/proc/sys/kernel/pid_max</code> 修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cat /proc/sys/kernel/pid_max</span></span><br><span class="line">32768</span><br></pre></td></tr></table></figure>
<p><strong>x86</strong> 架构不能将 <strong>当前运行</strong>的process 的 <strong>PD</strong> 存在<strong>寄存器</strong>中，因为它的寄存器太少了，但是 <strong>ppc</strong> 架构的可以 ，ppc 架构的寄存器多。</p>
<p>所以还是<strong>IBM</strong>厉害，寄存器都给的这么奢侈～～</p>
<blockquote>
<p>Contrast this approach with that taken by PowerPC (IBM’s modern RISC-based microprocessor), which stores the current task_struct in a register. Thus, current on PPC merely returns the value stored in the register r2. PPC can take this approach because, unlike x86, it has plenty of registers. Because accessing the process descriptor is a common and important job, the PPC kernel developers deem using a register worthy for the task.</p>
</blockquote>
<p>x86 架构存储的是 <strong>thread_info</strong> &lt;<code>The thread_info structure is defined on x86 in &lt;include/asm-x86_64/thread_info.h&gt;</code>&gt;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">thread_info</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span>	*<span class="title">task</span>;</span><span class="comment">// a point to pd</span></span><br><span class="line">	<span class="comment">/* main task structure */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">exec_domain</span>	*<span class="title">exec_domain</span>;</span>	<span class="comment">/* execution domain */</span></span><br><span class="line">	__u32			flags;		<span class="comment">/* low level flags */</span></span><br><span class="line">	__u32			status;		<span class="comment">/* thread synchronous flags */</span></span><br><span class="line">	__u32			cpu;		<span class="comment">/* current CPU */</span></span><br><span class="line">	<span class="keyword">int</span> 			preempt_count;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">mm_segment_t</span>		addr_limit;	</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">restart_block</span>    <span class="title">restart_block</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2><span id="jin-cheng-zhuang-tai">进程状态</span><a href="#jin-cheng-zhuang-tai" class="header-anchor">#</a></h2><p>pd 结构体中的 状态变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatile long state;	&#x2F;* -1 unrunnable, 0 runnable, &gt;0 stopped *&#x2F;</span><br></pre></td></tr></table></figure>
<p>一共<strong>5</strong>种 </p>
<ul>
<li><p>TASK_RUNNING<br>  正在运行或在运行队列中</p>
</li>
<li><p>TASK_INTERRUPTIBLE<br>  睡眠状态</p>
</li>
<li><p>TASK_UNINTERRUPTIBLE<br>  这个状态不好理解，意思是即使有其需要的资源，他也不一定会运行</p>
</li>
</ul>
<blockquote>
<p>• TASK_UNINTERRUPTIBLE—This state is identical to TASK_INTERRUPTIBLE except that it does not wake up and become runnable if it receives a signal. This is used in situations where the process must wait without interruption or when the event is expected to occur quite quickly. Because the task does not respond to signals in this state, TASK_UNINTERRUPTIBLE is less often used than TASK_INTERRUPTIBLE.</p>
</blockquote>
<blockquote>
<p>This is why you have those dreaded unkillable processes with state D in ps(1). Because the task will not respond to signals, you cannot send it a SIGKILL signal. Further, even if you could terminate the task, it would not be wise because the task is supposedly in the middle of an important operation and may hold a semaphore.</p>
</blockquote>
<ul>
<li><p>__TASK_TRACED</p>
</li>
<li><p>__TASK_STOPPED</p>
</li>
</ul>
<h2><span id="ru-he-gai-bian-jin-cheng-zhuang-tai">如何改变进程状态</span><a href="#ru-he-gai-bian-jin-cheng-zhuang-tai" class="header-anchor">#</a></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_task_state(task, state);        <span class="comment">/* set task &#x27;task&#x27; to state &#x27;state&#x27; */</span></span><br></pre></td></tr></table></figure>

<p>在linux/sched.h 中set_task_state函数 定义为 set_mb </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> set_task_state(tsk, state_value)		\</span></span><br><span class="line">	set_mb((tsk)-&gt;state, (state_value))</span><br></pre></td></tr></table></figure>
<p>set_mb在不同架构的处理器上的具体实现不一样</p>
<p>在<strong>x86_64</strong> 中</p>
<blockquote>
<p>include/asm-x86_64/system.h</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define set_mb(var, value) do &#123; xchg(&amp;var, value); &#125; while (0)</span><br></pre></td></tr></table></figure>
<p>在<strong>ppc</strong> 中</p>
<blockquote>
<p>include/asm-ppc/system.h</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define set_mb(var, value)	do &#123; var &#x3D; value; mb(); &#125; while (0)</span><br></pre></td></tr></table></figure>
<h2><span id="jin-cheng-shang-xia-wen">进程上下文</span><a href="#jin-cheng-shang-xia-wen" class="header-anchor">#</a></h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://franksma.github.io/2017/09/17/linux-kernel-development-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" data-id="ckk718x8b0008d64a5q3r2itl" data-title="linux kernel development 阅读笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-redhat实习总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/08/24/redhat%E5%AE%9E%E4%B9%A0%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2017-08-24T13:18:13.000Z" itemprop="datePublished">2017-08-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/08/24/redhat%E5%AE%9E%E4%B9%A0%E6%80%BB%E7%BB%93/">redhat实习总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在实习过程中见识到了很多我特别感兴趣的项目，但是苦于自己底子薄弱，无法深入研究。</p>
<h2><span id="dpdk-kvm-rt-kernel-rt-openvswitch">dpdk+kvm-rt+kernel-rt+openvswitch</span><a href="#dpdk-kvm-rt-kernel-rt-openvswitch" class="header-anchor">#</a></h2><p>这套方案是 Red Hat 的主推的NFV（Network Functions Virtualization）技术标准。<br>其中 dpdk 主要解决传统 linux 网络协议栈中数据包的传输要经过内核态和用户态的拷贝开销。dpdk的做法是将数据包传输全部放在用户态进行。由Intel提出并开源。主要基于Intel的网卡。</p>
<p>kvm-rt 和 kernel-rt 主要解决迅速判断问题，它能过迅速给出判断结果，并不是速度快。</p>
<p>openvswitch 主要解决SDN的需求，相对于传统的linux bridge，ovs可定制化程度更高。</p>
<h2><span id="question">Question</span><a href="#question" class="header-anchor">#</a></h2><p>开源软件，如 qemu-kvm 为什么要实现这么多功能。<br>为了降低数据包处理的延迟，将数据包从linux协议栈转移到内核态。安全性如何保障？</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://franksma.github.io/2017/08/24/redhat%E5%AE%9E%E4%B9%A0%E6%80%BB%E7%BB%93/" data-id="ckk718x880005d64aemy1g4e6" data-title="redhat实习总结" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redhat/" rel="tag">redhat</a></li></ul>

    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redhat/" rel="tag">redhat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/" rel="tag">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%95%E4%B8%9A/" rel="tag">毕业</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Rust/" style="font-size: 10px;">Rust</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/redhat/" style="font-size: 10px;">redhat</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/%E6%AF%95%E4%B8%9A/" style="font-size: 10px;">毕业</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/18/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">算法学习笔记</a>
          </li>
        
          <li>
            <a href="/2021/01/17/Rust-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Rust 学习笔记</a>
          </li>
        
          <li>
            <a href="/2018/03/09/%E6%AF%95%E4%B8%9A%E7%AD%94%E8%BE%A9%E5%AE%8C%E6%88%90/">毕业答辩完成</a>
          </li>
        
          <li>
            <a href="/2017/09/27/%E5%A5%97%E6%8E%A5%E5%AD%97%E4%B8%ADSO-REUSEPORT%E5%92%8CSO-REUSEADDR/">套接字中SO_REUSEPORT和SO_REUSEADDR</a>
          </li>
        
          <li>
            <a href="/2017/09/26/Understanding-the-Linux-kernel-%E7%AC%94%E8%AE%B0/">Understanding the Linux kernel 笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 TIANQI MA<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>